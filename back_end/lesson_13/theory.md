# Бизнес-логика

## 01. Реализация endpoint-а для удаления урока из курса

* По правилам REST можно endpoint назвать так:

`DELETE /api/courses/{course-id}/lessons/{lesson-id}`

### Один из возможных алгоритмов удаления подсущности

* Надо найти основную сущность по id (нашли по id конкретный курс)
* Взять множество подсущностей (список уроков конкретного курса)
* В этом множестве найти удаляемую подсущность по id
* В поле подсущности, отвечающим за `@ManyToOne` выставить `null` (у урока сделали `null` на курс)
* Заново сохранили подсущность

### В чем проблема такого подхода?

* Делаем лишний цикл, когда можно обойтись репозиторием (решить вопрос на уровне SQL)

### Решение

* Просто использовать репозиторий для подсущностей

## 02. Реализация endpoint-а для обновления урока (через курс)

* По нашей логике нельзя обновить урок, который не находится в курсе

`PUT /api/courses/{course-id}/lessons/{lesson-id}`

### Вопрос по обновлению

* Допустим, у нас есть поля, которые могут быть null
* А есть поля, которые null быть не могут
* Как правильно в этом случае сделать обновление?

## 03. Реализация endpoint-a для добавления студента в курс

`POST /api/courses/{course-id}/students`

```json
{
  "userId" : 4 
}
```

#### Рассмотрим наш пример

* Мы с вами понимаем, что не может быть урока без названия
* Поэтому имеет смысл сделать поле `name` - `not null`
  * Для этого ставим `nullable - false`
  * Если таблица уже была создана - руками добавляем `not null`
* Следовательно, мы допускаем, что могут быть значения `null`, но не допускаем "не передачи значений вообще"
* Оптимальное решение:
  * Добавить валидацию
  * В сервисе предусмотреть if-else, какая логика вам нужна (сохранять null или оставлять старое значение)

### Owner-связи

* Сохранение возможно только через Owner-а связи (владельца связи)
  * `JoinColumn` - OWNER
  * `JoinTable` - OWNER
  * `mappedBy` - не OWNER

## 04. Получение всех студентов курса

`GET /api/courses/{course-id}/students`

### Тезисы

* Посмотреть реализацию и соответствующие DTO:
  * `DELETE /api/courses/{course-id}/lessons/{lesson-id}`
  * `PUT    /api/courses/{course-id}/lessons/{lesson-id}`
  * `POST   /api/courses/{course-id}/students`
  * `GET    /api/courses/{course-id}/students`
